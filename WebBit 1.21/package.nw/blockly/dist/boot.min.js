!function(o,t){"use strict";t.initHandlebars(),Promise.all([new Promise(function(o){o(null)}),t.loadDoc("./views/"+t.PAGE.split("/")[0]+".handlebars").then(function(o){t.renderPage(o.body.innerHTML)}).then(function(){return new Promise(function(o){document.getElementById("simulator-frame").contentWindow.addEventListener("load",function(){o()},!1)})}),t.loadDoc("./toolbox/"+t.PAGE+".xml").then(function(o){t.rawToolbox=t.trimXml(o.body.firstChild)}).then(function(){return new Promise(function(n){if("BlocklyStorage"in o&&BlocklyStorage.isLinkUrl()){var e=location.hash.replace("#","");axios.get("/api/projects/linkData?hashid="+e).then(function(e){var i=e.data;return i&&i.errCode&&401===i.errCode?(swal({icon:"warning",title:MSG.loadProjectFailed,text:MSG.loginToReadLink,buttons:[MSG.cancel,MSG.loginPlatform]}).then(function(t){t&&o.open("https://id.webduino.io")}),n()):i&&i.errCode&&423===i.errCode?(swal({icon:"warning",title:MSG.linkExpired}),n()):(t.loadedData=i||null,void n(t.loadedData))}).catch(function(o){console.error("load project failed!",o.message),n()})}else n()})}).then(function(o){return o&&o.customBlocks}).then(function(o){var n=[],e=JSON.parse(localStorage.getItem("customBlocks"));return e&&(n=n.concat(e)),o&&(n=n.concat(o)),t.LOADER_CONFIG=n.filter(function(o,t,n){return n.indexOf(o)===t}),Promise.all(t.LOADER_CONFIG.map(function(o){return t.loadBlockDefs(o)})).then(function(o){return localStorage.setItem("customBlocks",JSON.stringify(n)),o})}).then(function(o){o.forEach(function(o){t.addToolbox(o.category,o.toolboxXml)})}),new Promise(function(t){o.addEventListener("load",function(){t()},!1)})]).then(async function(n){t.setUser(n[0]),t.updateTitle(n[0]),t.customTab.init(),t.init(t.getToolBox()),t.loadDemoArea(),t.loadSimulator(),t.loadGa(n[0]),t.ga(),t.importPrettify(),t.bindHotkey(o.document),t.checkDeviceOnline(),t.popWindow(),t.loadSample(),await t.addCustomBlocks(),t.addExtension(),t.loadJs("dist/lib/clipboard.min.js",function(){t.copyCode()}),t.loadJs("dist/lib/babel.min.js"),t.loadJs("dist/lib/saveSvgAsPng.min.js"),t.loadJs("dist/demoArea-resize.min.js"),t.loadJs("dist/demoArea-dnd.min.js"),t.loadJs("dist/simulator-resize.min.js"),t.loadJs("dist/simulator-dnd.min.js"),t.loadedData&&t.loadedData.simulator&&t.simulator.update(t.loadedData.simulator),chromeVersion.isValid()||swal({text:MSG.updateChrome,icon:"info"})}).catch(function(t){console.error(t),401!==t.status&&404!==t.status||(o.addEventListener("unload",function(){o.localStorage.clear()},!1),BlocklyStorage.alert("專案不存在或自訂積木載入發生問題!","error").then(function(o){location.href="/blockly"}))})}(window,window.Code);