!function(o,n){"use strict";n.initHandlebars(),Promise.all([new Promise(function(o){o(null)}),n.loadDoc("./views/"+n.PAGE.split("/")[0]+".handlebars").then(function(o){n.renderPage(o.body.innerHTML)}).then(function(){return new Promise(function(o){document.getElementById("simulator-frame").contentWindow.addEventListener("load",function(){o()},!1)})}),n.loadDoc("./toolbox/"+n.PAGE+".xml").then(function(o){n.rawToolbox=n.trimXml(o.body.firstChild)}).then(function(){return new Promise(function(t){if("BlocklyStorage"in o&&BlocklyStorage.isLinkUrl()){var e=location.hash.replace("#","");axios.get("/api/projects/linkData?hashid="+e).then(function(e){var i=e.data;return i&&i.errCode&&401===i.errCode?(swal({icon:"warning",title:MSG.loadProjectFailed,text:MSG.loginToReadLink,buttons:[MSG.cancel,MSG.loginPlatform]}).then(function(n){n&&o.open("https://id.webduino.io")}),t()):i&&i.errCode&&423===i.errCode?(swal({icon:"warning",title:MSG.linkExpired}),t()):(n.loadedData=i||null,void t(n.loadedData))}).catch(function(o){console.error("load project failed!",o.message),t()})}else t()})}).then(function(o){return o&&o.customBlocks}).then(function(o){var t=[],e=JSON.parse(localStorage.getItem("customBlocks"));return e&&(t=t.concat(e)),o&&(t=t.concat(o)),t=t.filter(function(o,n,t){return t.indexOf(o)===n}),n.LOADER_CONFIG=n.LOADER_CONFIG.concat(t),n.LOADER_CONFIG=n.LOADER_CONFIG.filter(function(o,n,t){return t.indexOf(o)===n}),Promise.all(n.LOADER_CONFIG.map(function(o){return n.loadBlockDefs(o)})).then(function(o){return localStorage.setItem("customBlocks",JSON.stringify(t)),o})}).then(function(o){o.forEach(function(o){n.addToolbox(o.category,o.toolboxXml)})}),new Promise(function(n){o.addEventListener("load",function(){n()},!1)})]).then(function(t){n.setUser(t[0]),n.updateTitle(t[0]),n.customTab.init(),n.init(n.getToolBox()),n.loadDemoArea(),n.loadSimulator(),n.loadGa(t[0]),n.ga(),n.importPrettify(),n.bindHotkey(o.document),n.checkDeviceOnline(),n.loadJs("dist/webduino-samples.min.js",function(){n.loadSample()}),n.loadJs("dist/lib/clipboard.min.js",function(){n.copyCode()}),n.loadJs("dist/lib/babel.min.js"),n.loadJs("dist/lib/saveSvgAsPng.min.js"),n.loadJs("dist/demoArea-resize.min.js"),n.loadJs("dist/demoArea-dnd.min.js"),n.loadJs("dist/simulator-resize.min.js"),n.loadJs("dist/simulator-dnd.min.js"),n.loadedData&&n.loadedData.simulator&&n.simulator.update(n.loadedData.simulator),chromeVersion.isValid()||swal({text:MSG.updateChrome,icon:"info"})}).catch(function(o){console.error(o),401!==o.status&&404!==o.status||BlocklyStorage.alert("專案不存在或此專案尚未公開分享!","error").then(function(o){location.href="/"})})}(window,window.Code);