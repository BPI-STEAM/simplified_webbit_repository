var faceAPI={info:{age:"?",gender:"?",smile:"?",faceRectangle:"?",scores:"?"},lastSendAgeTime:0,lastSendEmotionTime:0,sending:!1,upload:function(e,t){var n=new XMLHttpRequest;n.open("POST","https://westus.api.cognitive.microsoft.com/face/v1.0/detect?returnFaceId=true&returnFaceLandmarks=false&returnFaceAttributes=age,gender,smile",!0),n.setRequestHeader("Content-type","application/octet-stream"),n.setRequestHeader("Ocp-Apim-Subscription-Key","a58a3cfcb83c472485d70d57a27ed17f");var i=this;n.onreadystatechange=function(){if(document.getElementById("demo-area-08-canvas").style.display="",4==n.readyState&&200==n.status)for(var e=JSON.parse(n.responseText),s=0;s<e.length;s++)i.info.age=e[s].faceAttributes.age,i.info.gender=e[s].faceAttributes.gender,i.info.smile=e[s].faceAttributes.smile,t&&t(i.info);i.sending=!1},n.send(e)},uploadEmotion:function(e,t){var n=new XMLHttpRequest;n.open("POST","https://westus.api.cognitive.microsoft.com/emotion/v1.0/recognize?returnFaceLandmarks=true&returnFaceAttributes=age%2Cgender%2CheadPose%2Csmile%2CfacialHair%2Cglasses",!0),n.setRequestHeader("Content-type","application/octet-stream"),n.setRequestHeader("Ocp-Apim-Subscription-Key","e3f40316644542acbfe1474ea28789f6");var i=this;n.onreadystatechange=function(){if(document.getElementById("demo-area-08-canvas").style.display="",4==n.readyState&&200==n.status)for(var e=JSON.parse(n.responseText),s=0;s<e.length;s++)i.info.faceRectangle=e[s].faceRectangle,i.info.scores=e[s].scores,t&&t(i.info);i.sending=!1},n.send(e)},dataURItoBlob:function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),s=new Uint8Array(i),a=0;a<t.length;a++)s[a]=t.charCodeAt(a);return new Blob([i],{type:n})},getBlob:function(){if(!this.sending){this.sending=!0;var e=document.getElementById("demo-area-08-canvas"),t=document.getElementById("demo-area-08-video");e.style.display="NONE",e.getContext("2d").drawImage(t,0,0,e.width,e.height);var n=e.toDataURL("image/png");return this.dataURItoBlob(n)}},getAge:function(){var e=(new Date).getTime();return e-this.lastSendAgeTime>3e3&&(this.upload(this.getBlob()),this.lastSendAgeTime=e),this.info.age},getEmotion:function(){var e=(new Date).getTime();return e-this.lastSendEmotionTime>3e3&&(this.uploadEmotion(this.getBlob()),this.lastSendEmotionTime=e),this.info.scores}},webRTC={enable:!1,videoID:"",session:"",callback:function(){},startVideo:function(e,t){this.enable=!0,this.session=new RTCSession("session","pwd"),this.videoID=t;var n=this;this.session.onstream=function(e){$("#"+n.videoID).replaceWith(e.mediaElement),$(e.mediaElement).attr("id",n.videoID),n.callback()},this.session.onstreamended=function(e){},this.session.onstatechange=function(e){"request-rejected"==e.name&&alert(e.reason)},e=0===(e=e||location.host+":8080").indexOf("ws")?e:("https:"===location.protocol?"wss://":"ws://")+e,this.session.attachRemote(e+"/stream/webrtc")},ready:function(e){void 0!=typeof e&&(this.callback=e)}};function chartAPI(){return{chart:"",_text:"",_option:"",_subtext:"",init:function(e){this.stopRefresh(),this.chart=echarts.init(document.getElementById(e)),window.onresize=this.chart.resize},title:function(e){this._text=e},autoRefresh:function(e){var t=1e3*e,n=this;chartAPI._timer=setInterval(function(){n.refresh()},t)},stopRefresh:function(){""!==chartAPI._timer&&clearInterval(chartAPI._timer)},data:function(){return this._option},refresh:function(e){void 0!==e&&(this._option=e),this.chart.setOption(this._option,!0)},render:function(e){var t,n,i={title:{text:this._text,x:"center"},calculable:!0,series:[{name:"",type:"pie"}]};i.series[0]=(t=e,n=i.series[0],Object.keys(n).forEach(function(e){t[e]=n[e]}),t),this._option=i,this.chart.setOption(this._option,!0)}}}chartAPI._timer="";