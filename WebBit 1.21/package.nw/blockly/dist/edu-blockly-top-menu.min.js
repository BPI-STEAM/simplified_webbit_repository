!function(e,t){"use strict";let o=function(){let e=document.getElementById("runButton"),t=document.getElementById("demo-select"),o=document.getElementById("demoButton"),n=document.querySelector(".close-btn");e.setAttribute("status","stopping"),document.querySelector("#runButton i").setAttribute("class","icon-media-play-outline"),document.querySelector("#runButton span.menu-run").style.display="inline",document.querySelector("#runButton span.menu-stop").style.display="none",t.disabled=!1,o.disabled=!1,"open"==localStorage.demoArea?o.className="notext toolMenu opened":o.className="notext toolMenu",o.style.pointerEvents="auto",n.style.pointerEvents="auto",n.style.opacity=.5};t.toggleRunning=function(){t.running?o():function(){let e=document.getElementById("runButton"),t=document.getElementById("demo-select"),o=document.getElementById("demoButton"),n=document.querySelector(".close-btn");e.setAttribute("status","running"),document.querySelector("#runButton i").setAttribute("class","icon-media-stop-outline"),document.querySelector("#runButton span.menu-run").style.display="none",document.querySelector("#runButton span.menu-stop").style.display="inline",t.disabled=!0,o.disabled=!0,o.className="notext toolMenu running",o.style.pointerEvents="none",n.style.pointerEvents="none",n.style.opacity=.2}(),t.running=!t.running},t.checkLocal=function(){return-1!=location.search.indexOf("zh-hans")?"china":"global"},t.subMenuDisplay=function(e,t){let o=e||"web",n=t||"global",l=document.querySelectorAll("header .subMenu"),s=document.querySelectorAll("#extension-menu .pop-content>*");l.forEach(e=>{e.className=e.className.replace(/r.|r. | r./g,"");let t=0;e.querySelectorAll("div").forEach(e=>{e.classList.remove("show");let l=e.getAttribute("attr-type"),s=e.getAttribute("attr-local");-1!=l.indexOf(o)&&-1!=s.indexOf(n)&&(e.classList.add("show"),t+=1)}),e.classList.add("r"+t)}),s.forEach(e=>{-1!=e.getAttribute("attr-local").indexOf(n)&&e.classList.add("show")})},t.toggleCloudHost=function(){let e=document.getElementById("eduCloudHost"),n=document.querySelector("#eduCloudHost span"),l=document.getElementById("moreButton");e.addEventListener("click",function(){o(),n.innerHTML="部署中...",e.style.pointerEvents="none",t.startCloudHost().then(t=>{console.log(t),setTimeout(()=>{t?(alert("(≧▽≦) 雲端部署完成！"),n.innerHTML="雲端部署",e.style.pointerEvents="auto",ga("send","event","Webduino-blockly","menu click","雲端部署 ( 完成 )")):(n.innerHTML="雲端部署",e.style.pointerEvents="auto",ga("send","event","Webduino-blockly","menu click","雲端部署 ( 失敗 )"),alert("(TдT) 雲端部署發生問題！請檢查下列三點後重新部署。\n1. 開發板 Device ID 是否正確。\n2. 開發板是否正常連線至 Wi-Fi。\n3. 電腦的網路是否正常。"))},1e3)})}),l.addEventListener("mouseenter",function(){t.cloudHostCheck()})},t.cloudHostCheck=function(){let e=Blockly.Xml.workspaceToDom(t.workspace),o=Blockly.Xml.domToPrettyText(e),n=document.getElementById("eduCloudHostDiv"),l=document.getElementById("eduCloudHost");-1!=o.indexOf('<field name="type_">bit</field>')||-1!=o.indexOf('<field name="type_">usb</field>')||-1==o.indexOf('<field name="type_">wifi</field>')?(n.classList.add("disable"),l.style.pointerEvents="none"):(n.classList.remove("disable"),l.style.pointerEvents="auto")},t.eduExport=function(){let e=document.getElementById("eduExportButton");e.addEventListener("click",function(){let o=Blockly.Xml.workspaceToDom(t.workspace),n=Blockly.Xml.domToPrettyText(o),l=localStorage.customBlocks.replace(/\[|\]|\"/g,"").split(","),s=JSON.stringify({platform:"wbit",type:"json",xml:n,customBlocks:l});e.setAttribute("download","Webduino.json"),e.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(s))})},t.eduImport=function(){let e=document.getElementById("eduImportButton"),o=document.getElementById("eduImportInput");e.addEventListener("click",function(){o.click()}),o.addEventListener("change",function(e){if(confirm("開啟檔案會取代原本的內容呦~\n確定開啟嗎？")){let e=this.value.split(".").pop(),n=o.files[0],l=new FileReader;l.onload=async function(){let n,s;switch(t.workspace.clear(),e){case"xml":n=Blockly.Xml.textToDom(l.result),await t.addCustomBlocks(!1),Blockly.Xml.domToWorkspace(n,t.workspace),o.value="";break;case"json":let c=JSON.parse(l.result);if(n=Blockly.Xml.textToDom(c.xml),!(s=c.customBlocks)){s=["google-sheets","weather","radio","line"].map(e=>`${document.location.origin}/blockly/custom-blocks/${e}/blockly.json`)}await t.addCustomBlocks(s),Blockly.Xml.domToWorkspace(n,t.workspace),o.value=""}},l.readAsText(n)}else o.value=""})};let n=!0;t.popWindow=(()=>{const e=document.querySelectorAll(".pop-window"),t=document.querySelectorAll(".pop-close");e.forEach(e=>{let t=e;t.addEventListener("blur",()=>{n&&t.classList.remove("show")})}),t.forEach(e=>{let t=e;t.addEventListener("click",()=>{t.parentNode.classList.remove("show")})})}),t.loadSample=(()=>{const o=document.getElementById("sampleButton"),l=document.getElementById("sample-menu"),s=document.querySelectorAll("#sample-menu div[data-source]");o.addEventListener("click",()=>{l.classList.add("show"),l.focus(),document.querySelectorAll("#sample-menu div img").forEach(e=>{let t=e.getAttribute("data-src")||"samples/img/no-image.jpg";e.setAttribute("src",t)})}),s.forEach(o=>{let s=o,c=s.getAttribute("data-source"),a=s.querySelector("span").innerText;s.addEventListener("click",()=>{if(c)if(e.confirm("打開範例會取代原本的內容呦~\n確定打開嗎？")){t.workspace.clear();let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let o=JSON.parse(e.responseText),n=Blockly.Xml.textToDom(o.xml);Blockly.Xml.domToWorkspace(n,t.workspace),ga("send","event","Webduino-blockly","sample load",a),l.classList.remove("show")}},e.open("GET",c,!0),e.send()}else n=!1,setTimeout(()=>{n=!0})})})}),t.addCustomBlocks=async function(e){let o;switch(t.checkLocal()){case"global":o=["google-sheets","weather","radio","line"];break;case"china":o=[]}if(e){const o=localStorage.customBlocks.replace(/\[|\]|\"/g,"").split(",");await Promise.all(e.map(e=>{if(o.indexOf(e)<0)return t.customTab.$__add__(e)})),console.log("(User) Custom blocks loaded successful.")}else{localStorage.customBlocks.replace(/\[|\]|\"/g,"").length<=0?(await Promise.all(o.map(e=>{const o=`${document.location.origin}/blockly/custom-blocks/${e}/blockly.json`;return t.customTab.$__add__(o)})),console.log("(Default) Custom blocks loaded successful.")):console.log("(LocalStorage) Custom blocks loaded successful.")}},t.addExtension=async function(){const e=document.getElementById("eduExtension"),o=document.getElementById("extension-menu"),n=document.querySelectorAll("#extension-menu div[data-source]");e.addEventListener("click",()=>{o.classList.add("show"),o.focus(),document.querySelectorAll("#extension-menu div img").forEach(e=>{let t=e.getAttribute("data-src")||"custom-blocks/img/no-image.jpg";e.setAttribute("src",t)});const e=localStorage.customBlocks.replace(/\[|\]|\"/g,"").split(",");n.forEach(async function(t){const o=t,n=o.getAttribute("data-source"),l=`${document.location.origin}/blockly/custom-blocks/${n}/blockly.json`;if(e.indexOf(l)>=0){o.classList.add("add");const e=(await(()=>fetch(l).then(e=>e.json()).then(e=>e))()).types,t=localStorage[document.location.origin];e.every(e=>t.indexOf(`"${e}"`)>=0?(document.querySelector(`div[data-source="${n}"]`).classList.add("fixed"),!1):(document.querySelector(`div[data-source="${n}"]`).classList.remove("fixed"),!0))}else o.classList.remove("add")})}),n.forEach(async function(e){const o=e,n=o.getAttribute("data-source"),l=`${document.location.origin}/blockly/custom-blocks/${n}/blockly.json`;o.addEventListener("click",async function(){localStorage.customBlocks.replace(/\[|\]|\"/g,"").split(",").indexOf(l)>=0&&document.querySelector(`div[data-source="${n}"]`).className.indexOf("fixed")<=0?(await t.customTab.$__remove__(l),o.classList.remove("add")):(await t.customTab.$__add__(l),o.classList.add("add"))})})},t.rightAreaToggle=function(){let e=document.getElementById("mainTable"),t=document.getElementById("right-area-toggle"),o=document.getElementById("right-area"),n=document.querySelector("#right-area-toggle i"),l=document.getElementById("content_blocks"),s=document.querySelector("#content_blocks svg.blocklySvg"),c=document.getElementById("content_javascript"),a=document.querySelector(".blocklyScrollbarVertical"),i=document.querySelector(".blocklyScrollbarHorizontal");t.onclick=function(){if("icon-chevron-with-circle-right"==n.className){n.className="icon-chevron-with-circle-left",o.className="hide",e.className+=" w100",l.className+=" w100";let t=s.getAttribute("class")+" w100";s.setAttribute("class",t),c.className+=" w100",a.style.opacity="0",i.style.opacity="0"}else{n.className="icon-chevron-with-circle-right",o.className="",e.className=e.className.replace(" w100",""),l.className=l.className.replace(" w100","");let t=s.getAttribute("class").replace(" w100","");s.setAttribute("class",t),c.className=c.className.replace(" w100",""),a.style.opacity="0",i.style.opacity="0"}},s.addEventListener("mouseup",function(){a.style.opacity="1",i.style.opacity="1"}),document.querySelector(".blocklyTreeRoot").onclick=function(){a.style.opacity="1",i.style.opacity="1"}},t.rightAreaResize=function(){let t,o,n=document.getElementById("right-bar-area"),l=document.getElementById("demo-area"),s=document.getElementById("right-area-resize-bar"),c=document.getElementById("demo-resize-btn"),a=document.querySelector("#demo-resize-btn i"),i=0;localStorage.demoArea="",s.style.display="block",s.style.top=l.offsetTop-3+"px",s.onmousedown=function(){i=1,n.style.pointerEvents="auto"},n.onmouseup=function(){i=0,(t=event.pageY-70)<0&&(t=5),n.style.pointerEvents="none",s.className="",l.style.opacity="1"},n.onmousemove=function(){1==i?((o=event.pageY)<=70&&(o=70),s.className="dragged",s.style.top=o-70+"px",l.style.opacity="0.5",l.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)"):s.style.top=t+"px"},e.onresize=function(){o&&(l.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)",s.style.top=l.offsetTop-3+"px")},c.addEventListener("click",function(){let t=l.className;-1==t.indexOf("max")?(l.className=t+" max",a.className="icon-shrink",l.style=""):(l.className=t.replace(" max",""),a.className="icon-enlarge",o&&(l.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)",s.style.top=l.offsetTop-3+"px"))})}}(window,window.Code);