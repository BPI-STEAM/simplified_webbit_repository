!function(e,t){"use strict";let o=function(){let e=document.getElementById("runButton"),t=document.getElementById("demo-select"),o=document.getElementById("demoButton"),l=document.querySelector(".close-btn");e.setAttribute("status","stopping"),document.querySelector("#runButton i").setAttribute("class","icon-media-play-outline"),document.querySelector("#runButton span.menu-run").style.display="inline",document.querySelector("#runButton span.menu-stop").style.display="none",t.disabled=!1,o.disabled=!1,"open"==localStorage.demoArea?o.className="notext toolMenu opened":o.className="notext toolMenu",o.style.pointerEvents="auto",l.style.pointerEvents="auto",l.style.opacity=.5};t.toggleRunning=function(){t.running?o():function(){let e=document.getElementById("runButton"),t=document.getElementById("demo-select"),o=document.getElementById("demoButton"),l=document.querySelector(".close-btn");e.setAttribute("status","running"),document.querySelector("#runButton i").setAttribute("class","icon-media-stop-outline"),document.querySelector("#runButton span.menu-run").style.display="none",document.querySelector("#runButton span.menu-stop").style.display="inline",t.disabled=!0,o.disabled=!0,o.className="notext toolMenu running",o.style.pointerEvents="none",l.style.pointerEvents="none",l.style.opacity=.2}(),t.running=!t.running},t.checkLocal=function(){return-1!=location.search.indexOf("zh-hans")?"china":"global"},t.subMenuDisplay=function(e,t){let o=e||"web",l=t||"global",n=document.querySelectorAll("header .subMenu"),c=document.querySelectorAll("#extension-menu .pop-content>*");n.forEach(e=>{e.className=e.className.replace(/r.|r. | r./g,"");let t=0;e.querySelectorAll("div").forEach(e=>{e.classList.remove("show");let n=e.getAttribute("attr-type"),c=e.getAttribute("attr-local");-1!=n.indexOf(o)&&-1!=c.indexOf(l)&&(e.classList.add("show"),t+=1)}),e.classList.add("r"+t)}),c.forEach(e=>{-1!=e.getAttribute("attr-local").indexOf(l)&&e.classList.add("show")})},t.toggleCloudHost=function(){let e=document.getElementById("eduCloudHost"),l=document.querySelector("#eduCloudHost span"),n=document.getElementById("moreButton");e.addEventListener("click",function(){o(),l.innerHTML="部署中...",e.style.pointerEvents="none",t.startCloudHost().then(t=>{console.log(t),setTimeout(()=>{t?(alert("(≧▽≦) 雲端部署完成！"),l.innerHTML="雲端部署",e.style.pointerEvents="auto",ga("send","event","Webduino-blockly","menu click","雲端部署 ( 完成 )")):(l.innerHTML="雲端部署",e.style.pointerEvents="auto",ga("send","event","Webduino-blockly","menu click","雲端部署 ( 失敗 )"),alert("(TдT) 雲端部署發生問題！請檢查下列三點後重新部署。\n1. 開發板 Device ID 是否正確。\n2. 開發板是否正常連線至 Wi-Fi。\n3. 電腦的網路是否正常。"))},1e3)})}),n.addEventListener("mouseenter",function(){t.cloudHostCheck()})},t.cloudHostCheck=function(){let e=Blockly.Xml.workspaceToDom(t.workspace),o=Blockly.Xml.domToPrettyText(e),l=document.getElementById("eduCloudHostDiv"),n=document.getElementById("eduCloudHost");-1!=o.indexOf('<field name="type_">bit</field>')||-1!=o.indexOf('<field name="type_">usb</field>')||-1==o.indexOf('<field name="type_">wifi</field>')?(l.classList.add("disable"),n.style.pointerEvents="none"):(l.classList.remove("disable"),n.style.pointerEvents="auto")},t.eduExport=function(){let e=document.getElementById("eduExportButton");e.addEventListener("click",function(){let o=Blockly.Xml.workspaceToDom(t.workspace),l=Blockly.Xml.domToPrettyText(o),n=localStorage.customBlocks.replace(/\[|\]|\"/g,"").replace(new RegExp(location.origin,"g"),"").split(","),c=JSON.stringify({platform:"wbit",type:"json",xml:l,customBlocks:n});e.setAttribute("download","Webduino.json"),e.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(c))})},t.eduImport=function(){let e=document.getElementById("eduImportButton"),o=document.getElementById("eduImportInput");e.addEventListener("click",function(){o.click()}),o.addEventListener("change",function(e){if(confirm("開啟檔案會取代原本的內容呦~\n確定開啟嗎？")){let e=this.value.split(".").pop(),l=o.files[0],n=new FileReader;n.onload=async function(){let l,c;switch(t.workspace.clear(),e){case"xml":l=Blockly.Xml.textToDom(n.result),await t.addCustomBlocks(!1),Blockly.Xml.domToWorkspace(l,t.workspace),o.value="";break;case"json":let s=JSON.parse(n.result);if(l=Blockly.Xml.textToDom(s.xml),!(c=s.customBlocks)){c=["google-sheets","weather","radio","line"].map(e=>`${document.location.origin}/blockly/custom-blocks/${e}/blockly.json`)}await t.addCustomBlocks(c),Blockly.Xml.domToWorkspace(l,t.workspace),o.value=""}},n.readAsText(l)}else o.value=""})};let l=!0;t.popWindow=(()=>{const e=document.querySelectorAll(".pop-window"),t=document.querySelectorAll(".pop-close");e.forEach(e=>{let t=e;t.addEventListener("blur",()=>{l&&t.classList.remove("show")})}),t.forEach(e=>{let t=e;t.addEventListener("click",()=>{t.parentNode.classList.remove("show")})})}),t.loadSample=(()=>{const o=document.getElementById("sampleButton"),n=document.getElementById("sample-menu"),c=document.querySelectorAll("#sample-menu div[data-source]");o.addEventListener("click",()=>{n.classList.add("show"),n.focus(),document.querySelectorAll("#sample-menu div img").forEach(e=>{let t=e.getAttribute("data-src")||"samples/img/no-image.jpg";e.setAttribute("src",t)})}),c.forEach(o=>{let c=o,s=c.getAttribute("data-source"),a=c.querySelector("span").innerText;c.addEventListener("click",()=>{if(s)if(e.confirm("打開範例會取代原本的內容呦~\n確定打開嗎？")){t.workspace.clear();let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let o=JSON.parse(e.responseText),l=Blockly.Xml.textToDom(o.xml);Blockly.Xml.domToWorkspace(l,t.workspace),ga("send","event","Webduino-blockly","sample load",a),n.classList.remove("show")}},e.open("GET",s,!0),e.send()}else l=!1,setTimeout(()=>{l=!0})})})}),t.addCustomBlocks=async function(e){let o;switch(t.checkLocal()){case"global":o=["google-sheets","weather","radio","line"];break;case"china":o=[]}if(e){const o=(localStorage.customBlocks||"").replace(/\[|\]|\"/g,"").split(",")||[];await Promise.all(e.map(e=>{let l=location.origin+"/blockly/"+e.split("/blockly/")[1];if(console.log(l),o.indexOf(l)<0)return t.customTab.$__add__(l)})),console.log("(User) Custom blocks loaded successful.")}else{localStorage.customBlocks.replace(/\[|\]|\"/g,"").length<=0?(await Promise.all(o.map(e=>{const o=`${document.location.origin}/blockly/custom-blocks/${e}/blockly.json`;return t.customTab.$__add__(o)})),console.log("(Default) Custom blocks loaded successful.")):console.log("(LocalStorage) Custom blocks loaded successful.")}},t.addExtension=async function(){const e=document.getElementById("eduExtension"),o=document.getElementById("extension-menu"),l=document.querySelectorAll("#extension-menu div[data-source]");e.addEventListener("click",()=>{let e;o.classList.add("show"),o.focus(),document.querySelectorAll("#extension-menu div img").forEach(e=>{let t=e.getAttribute("data-src")||"custom-blocks/img/no-image.jpg";e.setAttribute("src",t)}),localStorage.customBlocks?e=localStorage.customBlocks.replace(/\[|\]|\"/g,"").split(","):(e=[`${document.location.origin}/blockly/custom-blocks/google-sheets/blockly.json`,`${document.location.origin}/blockly/custom-blocks/weather/blockly.json`,`${document.location.origin}/blockly/custom-blocks/radio/blockly.json`,`${document.location.origin}/blockly/custom-blocks/line/blockly.json`],t.addCustomBlocks(e)),l.forEach(async function(t){const o=t,l=o.getAttribute("data-source"),n=`${document.location.origin}/blockly/custom-blocks/${l}/blockly.json`;if(e.indexOf(n)>=0){o.classList.add("add");const e=(await(()=>fetch(n).then(e=>e.json()).then(e=>e))()).types,t=localStorage[document.location.origin];e.every(e=>t.indexOf(`"${e}"`)>=0?(document.querySelector(`div[data-source="${l}"]`).classList.add("fixed"),!1):(document.querySelector(`div[data-source="${l}"]`).classList.remove("fixed"),!0))}else o.classList.remove("add")})}),l.forEach(async function(e){const o=e,l=o.getAttribute("data-source"),n=`${document.location.origin}/blockly/custom-blocks/${l}/blockly.json`;o.addEventListener("click",async function(){localStorage.customBlocks.replace(/\[|\]|\"/g,"").split(",").indexOf(n)>=0&&document.querySelector(`div[data-source="${l}"]`).className.indexOf("fixed")<=0?(await t.customTab.$__remove__(n),o.classList.remove("add")):(await t.customTab.$__add__(n),o.classList.add("add"))})})},t.rightAreaToggle=function(){let e=document.getElementById("mainTable"),t=document.getElementById("right-area-toggle"),o=document.getElementById("right-area"),l=document.querySelector("#right-area-toggle i"),n=document.getElementById("content_blocks"),c=document.querySelector("#content_blocks svg.blocklySvg"),s=document.getElementById("content_javascript"),a=document.querySelector(".blocklyScrollbarVertical"),i=document.querySelector(".blocklyScrollbarHorizontal");t.onclick=function(){if("icon-chevron-with-circle-right"==l.className){l.className="icon-chevron-with-circle-left",o.className="hide",e.className+=" w100",n.className+=" w100";let t=c.getAttribute("class")+" w100";c.setAttribute("class",t),s.className+=" w100",a.style.opacity="0",i.style.opacity="0"}else{l.className="icon-chevron-with-circle-right",o.className="",e.className=e.className.replace(" w100",""),n.className=n.className.replace(" w100","");let t=c.getAttribute("class").replace(" w100","");c.setAttribute("class",t),s.className=s.className.replace(" w100",""),a.style.opacity="0",i.style.opacity="0"}},c.addEventListener("mouseup",function(){a.style.opacity="1",i.style.opacity="1"}),document.querySelector(".blocklyTreeRoot").onclick=function(){a.style.opacity="1",i.style.opacity="1"}},t.rightAreaResize=function(){let t,o,l=document.getElementById("right-bar-area"),n=document.getElementById("demo-area"),c=document.getElementById("right-area-resize-bar"),s=document.getElementById("demo-resize-btn"),a=document.querySelector("#demo-resize-btn i"),i=0;localStorage.demoArea="",c.style.display="block",c.style.top=n.offsetTop-3+"px",c.onmousedown=function(){i=1,l.style.pointerEvents="auto"},l.onmouseup=function(){i=0,(t=event.pageY-70)<0&&(t=5),l.style.pointerEvents="none",c.className="",n.style.opacity="1"},l.onmousemove=function(){1==i?((o=event.pageY)<=70&&(o=70),c.className="dragged",c.style.top=o-70+"px",n.style.opacity="0.5",n.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)"):c.style.top=t+"px"},e.onresize=function(){o&&(n.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)",c.style.top=n.offsetTop-3+"px")},s.addEventListener("click",function(){let t=n.className;-1==t.indexOf("max")?(n.className=t+" max",a.className="icon-shrink",n.style=""):(n.className=t.replace(" max",""),a.className="icon-enlarge",o&&(n.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)",c.style.top=n.offsetTop-3+"px"))})}}(window,window.Code);