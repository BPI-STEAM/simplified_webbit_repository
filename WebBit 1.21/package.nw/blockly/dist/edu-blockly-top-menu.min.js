!function(e,t){"use strict";let o=function(){let e=document.getElementById("runButton"),t=document.getElementById("demo-select"),o=document.getElementById("demoButton"),n=document.querySelector(".close-btn");e.setAttribute("status","stopping"),document.querySelector("#runButton i").setAttribute("class","icon-media-play-outline"),document.querySelector("#runButton span.menu-run").style.display="inline",document.querySelector("#runButton span.menu-stop").style.display="none",t.disabled=!1,o.disabled=!1,"open"==localStorage.demoArea?o.className="notext toolMenu opened":o.className="notext toolMenu",o.style.pointerEvents="auto",n.style.pointerEvents="auto",n.style.opacity=.5};t.toggleRunning=function(){t.running?o():function(){let e=document.getElementById("runButton"),t=document.getElementById("demo-select"),o=document.getElementById("demoButton"),n=document.querySelector(".close-btn");e.setAttribute("status","running"),document.querySelector("#runButton i").setAttribute("class","icon-media-stop-outline"),document.querySelector("#runButton span.menu-run").style.display="none",document.querySelector("#runButton span.menu-stop").style.display="inline",t.disabled=!0,o.disabled=!0,o.className="notext toolMenu running",o.style.pointerEvents="none",n.style.pointerEvents="none",n.style.opacity=.2}(),t.running=!t.running},t.checkLocal=function(){return-1!=location.search.indexOf("zh-hans")?"china":"global"},t.subMenuDisplay=function(e,t){let o=e||"web",n=t||"global";document.querySelectorAll("header .subMenu").forEach(e=>{e.className=e.className.replace(/r.|r. | r./g,"");let t=0;e.querySelectorAll("div").forEach(e=>{e.classList.remove("show");let l=e.getAttribute("attr-type"),c=e.getAttribute("attr-local");-1!=l.indexOf(o)&&-1!=c.indexOf(n)&&(e.classList.add("show"),t+=1)}),e.classList.add("r"+t)})},t.toggleCloudHost=function(){let e=document.getElementById("eduCloudHost"),n=document.querySelector("#eduCloudHost span"),l=document.getElementById("moreButton");e.addEventListener("click",function(){o(),n.innerHTML="部署中...",e.style.pointerEvents="none",t.startCloudHost().then(t=>{console.log(t),setTimeout(()=>{t?(alert("(≧▽≦) 雲端部署完成！"),n.innerHTML="雲端部署",e.style.pointerEvents="auto",ga("send","event","Webduino-blockly","menu click","雲端部署 ( 完成 )")):(n.innerHTML="雲端部署",e.style.pointerEvents="auto",ga("send","event","Webduino-blockly","menu click","雲端部署 ( 失敗 )"),alert("(TдT) 雲端部署發生問題！請檢查下列三點後重新部署。\n1. 開發板 Device ID 是否正確。\n2. 開發板是否正常連線至 Wi-Fi。\n3. 電腦的網路是否正常。"))},1e3)})}),l.addEventListener("mouseenter",function(){t.cloudHostCheck()})},t.cloudHostCheck=function(){let e=Blockly.Xml.workspaceToDom(t.workspace),o=Blockly.Xml.domToPrettyText(e),n=document.getElementById("eduCloudHostDiv"),l=document.getElementById("eduCloudHost");-1!=o.indexOf('<field name="type_">bit</field>')||-1!=o.indexOf('<field name="type_">usb</field>')||-1==o.indexOf('<field name="type_">wifi</field>')?(n.classList.add("disable"),l.style.pointerEvents="none"):(n.classList.remove("disable"),l.style.pointerEvents="auto")},t.eduPopWindow=function(){let e=document.querySelector(".pop-open"),t=document.querySelector(".pop-close"),o=document.querySelector(".pop-window"),n=document.querySelectorAll(".pop-content div img");e.onclick=(()=>{o.classList.remove("close"),n.forEach(e=>{let t=e;t.getAttribute("src")||t.setAttribute("src",t.getAttribute("data-src"))}),o.focus()}),t.onclick=(()=>{o.classList.add("close")}),o.onblur=(()=>{o.classList.add("close")})},t.addExtension=async function(){let e=document.location.origin;await t.customTab.$__add__(e+"/blockly/custom-blocks/line/blockly.json"),await t.customTab.$__add__(e+"/blockly/custom-blocks/radio/blockly.json"),await t.customTab.$__add__(e+"/blockly/custom-blocks/weather/blockly.json"),await t.customTab.$__add__(e+"/blockly/custom-blocks/google-sheets/blockly.json"),Promise.resolve().then(()=>{console.log("Custom blocks loaded successful.")})},t.eduExport=function(){let e=document.getElementById("eduExportButton");e.addEventListener("click",function(){let o=Blockly.Xml.workspaceToDom(t.workspace),n=Blockly.Xml.domToPrettyText(o),l=JSON.stringify({platform:"wbit",type:"json",xml:n});e.setAttribute("download","Webduino.json"),e.setAttribute("href","data:text/json;charset=utf-8,"+encodeURIComponent(l))})},t.eduImport=function(){let e=document.getElementById("eduImportButton"),o=document.getElementById("eduImportInput");e.addEventListener("click",function(){o.click()}),o.addEventListener("change",function(e){if(confirm("開啟檔案會取代原本的內容呦~\n確定開啟嗎？")){let e=this.value.split(".").pop(),n=o.files[0],l=new FileReader;l.onload=async function(){let n;switch(t.workspace.clear(),e){case"xml":n=Blockly.Xml.textToDom(l.result),Blockly.Xml.domToWorkspace(n,t.workspace),o.value="";break;case"json":let c=JSON.parse(l.result);n=Blockly.Xml.textToDom(c.xml),Blockly.Xml.domToWorkspace(n,t.workspace),o.value=""}},l.readAsText(n)}else o.value=""})},t.loadSample=function(){var o=document.getElementById("sampleButton"),n=document.getElementById("sample-menu"),l=document.getElementById("sample-menu-close-btn"),c=!1,s=!1,a=document.getElementById("sample-menu-content");o.onmouseover=function(){s=!0},o.onmouseleave=function(){s=!1},o.onclick=function(){document.querySelectorAll("#sample-menu-content div img").forEach(e=>{let t=e.getAttribute("data-src")||"samples/img/no-image.jpg";e.setAttribute("src",t)}),c?(c=!1,n.style.display="none",o.className="notext toolMenu"):(c=!0,n.style.display="block",o.className="notext toolMenu opened",n.focus())},n.onblur=function(){console.log(456),s||(c=!1,n.style.display="none",o.className="notext toolMenu")},l.onclick=function(){c=!1,n.style.display="none",o.className="notext toolMenu"},a.onclick=function(o){let n=o.target,c=n.querySelector("span").innerHTML,s=n.getAttribute("data-source"),a=s.split(".").pop();if(s&&e.confirm("打開範例會取代原本的內容呦~\n確定打開嗎？")){t.workspace.clear();let e=new XMLHttpRequest;e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let o;switch(a){case"xml":o=Blockly.Xml.textToDom(e.responseText);break;case"json":let t=JSON.parse(e.responseText);o=Blockly.Xml.textToDom(t.xml)}Blockly.Xml.domToWorkspace(o,t.workspace),ga("send","event","Webduino-blockly","sample load",c),l.click()}},e.open("GET",s,!0),e.send()}}},t.rightAreaToggle=function(){let e=document.getElementById("mainTable"),t=document.getElementById("right-area-toggle"),o=document.getElementById("right-area"),n=document.querySelector("#right-area-toggle i"),l=document.getElementById("content_blocks"),c=document.querySelector("#content_blocks svg.blocklySvg"),s=document.getElementById("content_javascript"),a=document.querySelector(".blocklyScrollbarVertical"),i=document.querySelector(".blocklyScrollbarHorizontal");t.onclick=function(){if("icon-chevron-with-circle-right"==n.className){n.className="icon-chevron-with-circle-left",o.className="hide",e.className+=" w100",l.className+=" w100";let t=c.getAttribute("class")+" w100";c.setAttribute("class",t),s.className+=" w100",a.style.opacity="0",i.style.opacity="0"}else{n.className="icon-chevron-with-circle-right",o.className="",e.className=e.className.replace(" w100",""),l.className=l.className.replace(" w100","");let t=c.getAttribute("class").replace(" w100","");c.setAttribute("class",t),s.className=s.className.replace(" w100",""),a.style.opacity="0",i.style.opacity="0"}},c.addEventListener("mouseup",function(){a.style.opacity="1",i.style.opacity="1"}),document.querySelector(".blocklyTreeRoot").onclick=function(){a.style.opacity="1",i.style.opacity="1"}},t.rightAreaResize=function(){let t,o,n=document.getElementById("right-bar-area"),l=document.getElementById("demo-area"),c=document.getElementById("right-area-resize-bar"),s=document.getElementById("demo-resize-btn"),a=document.querySelector("#demo-resize-btn i"),i=0;localStorage.demoArea="",c.style.display="block",c.style.top=l.offsetTop-3+"px",c.onmousedown=function(){i=1,n.style.pointerEvents="auto"},n.onmouseup=function(){i=0,(t=event.pageY-70)<0&&(t=5),n.style.pointerEvents="none",c.className="",l.style.opacity="1"},n.onmousemove=function(){1==i?((o=event.pageY)<=70&&(o=70),c.className="dragged",c.style.top=o-70+"px",l.style.opacity="0.5",l.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)"):c.style.top=t+"px"},e.onresize=function(){o&&(l.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)",c.style.top=l.offsetTop-3+"px")},s.addEventListener("click",function(){let t=l.className;-1==t.indexOf("max")?(l.className=t+" max",a.className="icon-shrink",l.style=""):(l.className=t.replace(" max",""),a.className="icon-enlarge",o&&(l.style.height="calc(50% - "+(o-e.innerHeight/2-35)+"px)",c.style.top=l.offsetTop-3+"px"))})}}(window,window.Code);